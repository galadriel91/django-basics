{% extends 'base.html' %}
{% block content %}
<nav>
    <h1><a href="{% url 'feeds' %}">Pystagram</a></h1>
    <a href="{% url 'logout' %}">logout</a>
</nav>
<div id="feeds" class="post-container">
    {% for post in posts %}
    <article class="post" id="{{post.id}}">
        <header class="post-header">
            {% if post.user.profile_image %}
                <img src="{{post.user.profile_image.url}}" alt="">
            {% endif %}
            <span> {{post.user.username}} </span>
        </header>
        <div class="post-images splide">
            <div class="splide__track">
                <ul class="splide__list">
                    {% for image in post.postimage_set.all %}
                        {% if image.photo %}
                        <li class="splide__slide">
                            <img src="{{ image.photo.url }}" alt="">
                        </li>
                        {% endif %}
                    {% endfor %}
                </ul>
            </div>
        </div>
        <div class="post-content">
            {{ post.content | linebreaksbr }}
        </div>
        <div class="post-buttons">
            <button>Likes(0)</button>
            <span>Comments({{post.comment_set.count}})</span>
        </div>
        <div class="post-comments">
            <ul>
                {% for comment in post.comment_set.all %}
                    <li>
                        <span>{{ comment.user.username }}</span>
                        <span>{{ comment.content }}</span>
                        {% if user == comment.user %}
                            <form method="POST" action="/posts/comment_remove/{{comment.id}}">
                                {% csrf_token %}
                                <button type="submit">삭제</button>
                            </form>
                        {% endif %}
                    </li>
                {% endfor %}
            </ul>
        </div>
        <small>{{post.created}}</small>
        <div class="post-comment-create">
            <form method="POST" action="{% url 'commentAdd' %}">
                {% csrf_token %}
                <input type="hidden" name="post" value="{{post.id}}">
                {{ form.content }}
                <button type="submit">작성</button>
            </form>
        </div>
    </article>
    {% endfor %}
</div>
    <script>
        const elem = document.getElementsByClassName('splide')
        for(let i =0; i < elem.length; i++){
            new Splide(elem[i]).mount()
        }
    </script>
{% endblock %}